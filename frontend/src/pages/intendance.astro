---
// ==============================================================================
// PAGE : INTENDANCE (V4 - CONNECT√âE)
// ==============================================================================
import Layout from '../layouts/Layout.astro';
---

<Layout title="Intendance & R√©sidence Secondaire | Maison des Sables">
	
	<nav class="fixed top-0 w-full z-50 px-6 md:px-12 py-8 flex justify-between items-center mix-blend-difference text-white transition-all duration-500">
		<a href="/" class="font-serif text-xl tracking-wider font-semibold hover:text-or transition-colors">‚Üê Retour</a>
		<a href="/" class="hidden md:block font-serif text-2xl tracking-wider font-bold">Maison des Sables</a>
		<a href="#contact" class="border border-white/30 px-6 py-2 text-xs font-sans uppercase tracking-widest rounded-std hover:bg-white hover:text-charbon transition-all">Contact</a>
	</nav>

	<header class="relative h-[70vh] bg-charbon overflow-hidden flex items-center justify-center">
		<div class="absolute inset-0 overflow-hidden">
			<img src="/gestion.jpg" alt="Intendance" class="absolute inset-0 w-full h-full object-cover opacity-60 grayscale-[20%] scale-105 animate-slow-zoom"/>
		</div>
		<div class="absolute inset-0 bg-gradient-to-b from-charbon/60 via-transparent to-sable"></div>
		
		<div class="relative z-10 text-center px-4 mt-20 max-w-4xl">
			<span class="inline-block py-1 px-3 border border-white/20 rounded-full text-[10px] font-sans tracking-[0.2em] uppercase text-white/80 mb-6 backdrop-blur-md">Propri√©taires R√©sidants</span>
			<h1 class="font-serif text-5xl md:text-8xl text-sable mb-8 leading-tight">Votre Maison,<br/><span class="italic text-or">Toujours Pr√™te.</span></h1>
			<p class="text-sable/80 max-w-xl mx-auto font-sans text-lg leading-relaxed">
				Ne g√¢chez plus vos arriv√©es. Nous veillons, a√©rons et pr√©parons votre r√©sidence secondaire pour que chaque s√©jour soit des vacances d√®s la premi√®re seconde.
			</p>
		</div>
	</header>

	<section class="bg-sable text-charbon py-24 px-6 md:px-12">
		<div class="max-w-7xl mx-auto">
			
			<div class="text-center mb-16">
				<span class="text-or text-xs font-sans tracking-[0.2em] uppercase mb-4 block">S√©r√©nit√© Absolue</span>
				<h3 class="font-serif text-4xl md:text-5xl mb-6">Nos Prestations</h3>
				<p class="font-sans text-charbon/60 max-w-2xl mx-auto">
					D√©couvrez comment nous prot√©geons et valorisons votre bien en votre absence.
				</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
				
				<div class="service-card group bg-white rounded-[2rem] overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 cursor-pointer border border-charbon/5 hover:-translate-y-2" data-service="Vigilance">
					<div class="h-64 overflow-hidden relative">
						<img src="/gestion.jpg" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Vigilance"/>
						<div class="absolute inset-0 bg-charbon/10 group-hover:bg-transparent transition-colors"></div>
					</div>
					<div class="p-8">
						<div class="w-12 h-12 rounded-full bg-sable flex items-center justify-center text-xl mb-6 text-charbon">üëÅÔ∏è</div>
						<h4 class="font-serif text-2xl mb-4 text-charbon">Vigilance</h4>
						<p class="text-sm text-charbon/70 leading-relaxed mb-6">
							Passages r√©guliers pour v√©rifier l'absence d'effraction, de fuite ou de d√©g√¢t. Un rapport photo vous est envoy√© syst√©matiquement.
						</p>
						<span class="text-xs font-bold uppercase tracking-widest text-or border-b border-or/20 pb-1 group-hover:border-or transition-colors">S√©lectionner</span>
					</div>
				</div>

				<div class="service-card group bg-white rounded-[2rem] overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 cursor-pointer border border-charbon/5 hover:-translate-y-2" data-service="Arriv√©e VIP">
					<div class="h-64 overflow-hidden relative">
						<img src="/gestion.jpg" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 sepia-[30%]" alt="Arriv√©e VIP"/>
						<div class="absolute inset-0 bg-charbon/10 group-hover:bg-transparent transition-colors"></div>
					</div>
					<div class="p-8">
						<div class="w-12 h-12 rounded-full bg-sable flex items-center justify-center text-xl mb-6 text-charbon">‚ú®</div>
						<h4 class="font-serif text-2xl mb-4 text-charbon">Arriv√©e VIP</h4>
						<p class="text-sm text-charbon/70 leading-relaxed mb-6">
							Sentez-vous en vacances d√®s la premi√®re seconde. Chauffage allum√©, lits faits, frigo rempli selon vos d√©sirs.
						</p>
						<span class="text-xs font-bold uppercase tracking-widest text-or border-b border-or/20 pb-1 group-hover:border-or transition-colors">S√©lectionner</span>
					</div>
				</div>

				<div class="service-card group bg-white rounded-[2rem] overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 cursor-pointer border border-charbon/5 hover:-translate-y-2" data-service="Coordination">
					<div class="h-64 overflow-hidden relative">
						<img src="/gestion.jpg" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 grayscale-[50%]" alt="Coordination"/>
						<div class="absolute inset-0 bg-charbon/10 group-hover:bg-transparent transition-colors"></div>
					</div>
					<div class="p-8">
						<div class="w-12 h-12 rounded-full bg-sable flex items-center justify-center text-xl mb-6 text-charbon">üõ†Ô∏è</div>
						<h4 class="font-serif text-2xl mb-4 text-charbon">Coordination</h4>
						<p class="text-sm text-charbon/70 leading-relaxed mb-6">
							Gestion compl√®te de vos prestataires (jardinier, pisciniste) et acc√®s aux artisans pour les petits travaux en votre absence.
						</p>
						<span class="text-xs font-bold uppercase tracking-widest text-or border-b border-or/20 pb-1 group-hover:border-or transition-colors">S√©lectionner</span>
					</div>
				</div>

			</div>
		</div>
	</section>

	<section class="bg-white py-24 px-6 md:px-12 border-t border-charbon/5">
		<div class="max-w-7xl mx-auto">
			<div class="text-center mb-16">
				<span class="text-or text-xs font-sans tracking-[0.2em] uppercase mb-4 block">Abonnements</span>
				<h3 class="font-serif text-4xl md:text-5xl text-charbon">Choisissez votre S√©r√©nit√©</h3>
				<p class="mt-6 text-charbon/60">Cliquez sur une formule pour la s√©lectionner.</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
				
				<div class="plan-card group relative bg-sable p-10 rounded-[2rem] border border-transparent hover:border-or/50 cursor-pointer transition-all duration-300 hover:-translate-y-2" data-plan="Formule Essentiel">
					<div class="flex justify-between items-start mb-8">
						<h4 class="font-bold uppercase tracking-widest text-sm text-charbon/60">Essentiel</h4>
						<div class="check-circle w-6 h-6 rounded-full border border-charbon/20 flex items-center justify-center transition-colors group-hover:bg-or group-hover:border-or">
							<span class="check-icon text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">‚úì</span>
						</div>
					</div>
					<p class="text-5xl font-serif text-charbon mb-2">50‚Ç¨<span class="text-base text-charbon/40 font-sans">/mois</span></p>
					<p class="text-sm text-charbon/60 mb-8 min-h-[3em]">Pour garder un ≈ìil sur votre bien.</p>
					<ul class="space-y-4 text-sm text-charbon/80 border-t border-charbon/5 pt-8">
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> 2 visites de vigilance / mois</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Rapport photo</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Gestion des cl√©s</li>
					</ul>
				</div>

				<div class="plan-card group relative bg-sable p-10 rounded-[2rem] border border-transparent hover:border-or/50 cursor-pointer transition-all duration-300 hover:-translate-y-2" data-plan="Formule Confort Total">
					<div class="absolute top-0 right-0 bg-charbon text-white text-[10px] font-bold px-4 py-2 rounded-bl-[1rem]">POPULAIRE</div>
					
					<div class="flex justify-between items-start mb-8">
						<h4 class="font-bold uppercase tracking-widest text-sm text-or">Confort Total</h4>
						<div class="check-circle w-6 h-6 rounded-full border border-charbon/20 flex items-center justify-center transition-colors group-hover:bg-or group-hover:border-or">
							<span class="check-icon text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">‚úì</span>
						</div>
					</div>
					<p class="text-5xl font-serif text-charbon mb-2">120‚Ç¨<span class="text-base text-charbon/40 font-sans">/mois</span></p>
					<p class="text-sm text-charbon/60 mb-8 min-h-[3em]">La formule id√©ale pour profiter sans contraintes.</p>
					<ul class="space-y-4 text-sm text-charbon/80 border-t border-charbon/5 pt-8">
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> 4 visites de vigilance / mois</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Pr√©paration arriv√©e (x2/an)</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Rel√®ve courrier & Arrosage</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Astreinte temp√™te 24/7</li>
					</ul>
				</div>

				<div class="plan-card group relative bg-sable p-10 rounded-[2rem] border border-transparent hover:border-or/50 cursor-pointer transition-all duration-300 hover:-translate-y-2" data-plan="Formule Prestige (Sur Devis)">
					<div class="flex justify-between items-start mb-8">
						<h4 class="font-bold uppercase tracking-widest text-sm text-charbon/60">Prestige</h4>
						<div class="check-circle w-6 h-6 rounded-full border border-charbon/20 flex items-center justify-center transition-colors group-hover:bg-or group-hover:border-or">
							<span class="check-icon text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">‚úì</span>
						</div>
					</div>
					<p class="text-4xl font-serif text-charbon mb-2 mt-2">Sur Devis</p>
					<p class="text-sm text-charbon/60 mb-8 min-h-[3em]">Gestion int√©grale 100% sur-mesure.</p>
					<ul class="space-y-4 text-sm text-charbon/80 border-t border-charbon/5 pt-8">
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Visites illimit√©es</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Conciergerie priv√©e incluse</li>
						<li class="flex items-center"><span class="text-or mr-2">‚úì</span> Suivi de travaux</li>
					</ul>
				</div>

			</div>
		</div>
	</section>

	<section id="contact" class="bg-sable text-charbon py-24 px-6 md:px-12 border-t border-charbon/5 scroll-mt-20">
		<div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16">
			<div>
				<span class="text-or text-xs font-sans tracking-[0.2em] uppercase mb-4 block">Souscrire</span>
				<h3 class="font-serif text-3xl md:text-4xl mb-6">Mise en place rapide</h3>
				<p class="font-sans text-charbon/70 mb-8 leading-relaxed">
					Une fois le formulaire envoy√©, nous vous contactons pour organiser la premi√®re visite technique et la remise des cl√©s.
				</p>
				<div class="space-y-8 mt-12">
					<div class="flex items-start gap-6">
						<div class="w-12 h-12 rounded-full bg-white border border-or/20 flex items-center justify-center text-or shrink-0">‚úâÔ∏è</div>
						<div><p class="text-xs uppercase tracking-widest text-charbon/40 mb-1">Email</p><a href="mailto:bonjour@maisondesables.fr" class="font-serif text-xl text-charbon hover:text-or transition-colors">bonjour@maisondesables.fr</a></div>
					</div>
					<div class="flex items-start gap-6">
						<div class="w-12 h-12 rounded-full bg-white border border-or/20 flex items-center justify-center text-or shrink-0">üìû</div>
						<div><p class="text-xs uppercase tracking-widest text-charbon/40 mb-1">T√©l√©phone</p><a href="tel:+33556000000" class="font-serif text-xl text-charbon hover:text-or transition-colors">+33 5 56 00 00 00</a></div>
					</div>
				</div>
			</div>

			<form id="contact-form" class="space-y-6 bg-white p-10 rounded-[2rem] shadow-lg border border-charbon/5">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					<div class="group">
						<label class="text-xs uppercase tracking-widest text-charbon/40 mb-2 block">Nom</label>
						<input type="text" name="name" class="w-full bg-sable/30 border-b border-charbon/10 p-3 text-charbon outline-none focus:border-or transition-all" required/>
					</div>
					<div class="group">
						<label class="text-xs uppercase tracking-widest text-charbon/40 mb-2 block">T√©l√©phone</label>
						<input type="tel" name="phone" class="w-full bg-sable/30 border-b border-charbon/10 p-3 text-charbon outline-none focus:border-or transition-all" required/>
					</div>
				</div>
				<div class="group">
					<label class="text-xs uppercase tracking-widest text-charbon/40 mb-2 block">Email</label>
					<input type="email" name="email" class="w-full bg-sable/30 border-b border-charbon/10 p-3 text-charbon outline-none focus:border-or transition-all" required/>
				</div>
				
				<div class="group">
					<label class="text-xs uppercase tracking-widest text-charbon/40 mb-2 block">Formule S√©lectionn√©e</label>
					<input type="text" name="property_details" id="selected-plan-input" class="w-full bg-or/10 border-b border-or p-3 text-charbon font-bold outline-none" value="Aucune formule s√©lectionn√©e" readonly/>
				</div>

				<div class="group">
					<label class="text-xs uppercase tracking-widest text-charbon/40 mb-2 block">Commentaires additionnels</label>
					<textarea name="message" rows="3" class="w-full bg-sable/30 border-b border-charbon/10 p-3 text-charbon outline-none focus:border-or transition-all resize-none"></textarea>
				</div>
				<button type="submit" class="w-full bg-charbon text-sable py-4 rounded-std font-bold uppercase tracking-widest hover:bg-or hover:text-white transition-colors shadow-lg hover:shadow-or/30">Envoyer ma demande</button>
			</form>
		</div>
	</section>

	<footer class="bg-charbon text-sable py-12 text-center border-t border-white/10">
		<p class="font-serif text-2xl mb-4">Maison des Sables</p>
	</footer>
</Layout>

<style>
	.animate-fade-in-up { animation: fadeInUp 1s ease-out forwards; opacity: 0; transform: translateY(20px); }
	.animate-slow-zoom { animation: zoom 20s infinite alternate; }
	.delay-100 { animation-delay: 0.1s; }
	@keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
	@keyframes zoom { from { transform: scale(1); } to { transform: scale(1.1); } }
</style>

<script>
	['astro:page-load', 'load'].forEach(event => {
		window.addEventListener(event, () => {
			
			// --- 1. CONNEXION CERVEAU ---
			const form = document.getElementById('contact-form') as HTMLFormElement;
			if (form) {
				form.addEventListener('submit', async (e) => {
					e.preventDefault(); 
					const formData = new FormData(form);
					const data = Object.fromEntries(formData);

					// @ts-ignore
					data.service_name = "Intendance"; 
					
					try {
						const response = await fetch('http://localhost:5000/api/contact/lead', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify(data)
						});
						const result = await response.json();
						if (response.ok) {
							alert("‚úÖ Demande envoy√©e ! Nous vous recontacterons tr√®s vite.");
							form.reset();
						} else {
							alert("‚ùå Erreur : " + (result.error || "Probl√®me inconnu"));
						}
					} catch (error) {
						console.error(error);
						alert("‚ùå Impossible de contacter le serveur.");
					}
				});
			}

			// --- 2. UI LOGIQUE ---
			const serviceCards = document.querySelectorAll('.service-card');
			const formInput = document.getElementById('selected-plan-input') as HTMLInputElement;
			const contactSection = document.getElementById('contact');

			serviceCards.forEach(card => {
				card.addEventListener('click', () => {
					// @ts-ignore
					const serviceName = card.dataset.service;
					if(formInput) {
						formInput.value = `Service : ${serviceName}`;
						formInput.parentElement.classList.add('animate-pulse');
						setTimeout(() => formInput.parentElement.classList.remove('animate-pulse'), 1000);
					}
					if(contactSection) contactSection.scrollIntoView({ behavior: 'smooth' });
				});
			});

			// S√âLECTION DES PRIX (ABONNEMENTS)
			const cards = document.querySelectorAll('.plan-card');

			cards.forEach(card => {
				card.addEventListener('click', () => {
					// @ts-ignore
					const planName = card.dataset.plan;

					// Reset Visuals
					cards.forEach(c => {
						c.classList.remove('ring-2', 'ring-or', 'scale-105', 'opacity-100');
						c.classList.add('opacity-50');
						const circle = c.querySelector('.check-circle');
						const icon = c.querySelector('.check-icon');
						if(circle) {
							circle.classList.remove('bg-or', 'border-or');
							circle.classList.add('border-charbon/20');
						}
						if(icon) {
							icon.classList.remove('opacity-100');
							icon.classList.add('opacity-0');
						}
					});

					// Active Visuals
					card.classList.remove('opacity-50');
					card.classList.add('ring-2', 'ring-or', 'scale-105', 'opacity-100');
					const activeCircle = card.querySelector('.check-circle');
					const activeIcon = card.querySelector('.check-icon');
					if(activeCircle) {
						activeCircle.classList.remove('border-charbon/20');
						activeCircle.classList.add('bg-or', 'border-or');
					}
					if(activeIcon) {
						activeIcon.classList.remove('opacity-0');
						activeIcon.classList.add('opacity-100');
					}

					// Update Form
					if(formInput) {
						formInput.value = planName;
						formInput.parentElement.classList.add('animate-pulse');
						setTimeout(() => formInput.parentElement.classList.remove('animate-pulse'), 1000);
					}
					if(contactSection) contactSection.scrollIntoView({ behavior: 'smooth' });
				});
			});

		});
	});
</script>